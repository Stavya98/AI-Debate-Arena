<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}AI Debate Arena{% endblock %}</title>
  <link rel="stylesheet" href="/static/style.css">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>

<body>

{% include "navbar.html" %}

{% block content %}{% endblock %}

<!-- ðŸ” GLOBAL AUTH SCRIPT -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const firebaseConfig = {
    apiKey: "AIzaSyAbOyLmzRSq4mkfAPpC1GZUCE9IYC4rE9Y",
    authDomain: "ai-debate-arena-sj.firebaseapp.com",
    projectId: "ai-debate-arena-sj",
    appId: "1:691661161018:web:b3f6875cfc75e86710ab03"
  };

  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }

  const auth = firebase.auth();

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const historyLink = document.getElementById("historyLink");
  const userInfo = document.getElementById("userInfo");

  loginBtn?.addEventListener("click", async () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    await auth.signInWithPopup(provider);
  });

  logoutBtn?.addEventListener("click", async () => {
    await fetch("/logout", { method: "POST" });
    await auth.signOut();
    window.location.href = "/";
  });

  auth.onAuthStateChanged(async (user) => {
    window.IS_LOGGED_IN = !!user;
    
    if (!user) {
      loginBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";
      historyLink.style.display = "none";
      userInfo.textContent = "";
      return;
    }

    loginBtn.style.display = "none";
    logoutBtn.style.display = "inline-block";
    historyLink.style.display = "inline-block";
    userInfo.textContent = user.displayName || "User";

    const token = await user.getIdToken();
    await fetch("/login", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams({ auth_token: token })
    });
  });
});
</script>

</body>
</html>
